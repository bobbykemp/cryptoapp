{% extends "app/base.html" %}
{% block content %}
{%load rest_framework%}

<table class="table table-dark">
  <form action="/api/user/">
    <select id="user-select"
  </form>
  <thead>
  <tr>
    <th scope="col">ID</th>
    <th scope="col">Private Key</th>
    <th scope="col">Public Key</th>
  </tr>
  </thead>
  <tbody id="key-table-body">
  </tbody>
</table>

<script>

  $(document).ready(function() {
    $.ajax({
      url: '/api/private-keys/',
      dataType: 'json',
      success: function(data){
        $.each(data, function(index){
          var id = data[index]['secure_id'];
          var key = data[index]['key_from_bytes'];
          $('#key-table-body').append(`
            <tr>
              <td>${id}</td>
              <td>
                <a class="btn btn-light" href="/api/private-keys/${id}/get_private_key_as_file/">Download Private Key</a>
              </td>
              <td>
                <a class="btn btn-light" href="/api/private-keys/${id}/get_public_key_as_file/">Download Public Key</a>
              </td>
            </tr>
          `);
        });
      }
    });

    $("#key-table-body").on('click', ':button', function(){
      var id = $(this).attr('id');
      var type = $(this).attr('keytype');
      $.ajax({
        url: '/api/private-keys/' + id + '/get_' + type + '_key_as_file/',
        method: 'POST',
        dataType: 'octet-stream',
        beforeSend(xhr, settings) {
          xhr.setRequestHeader("X-CSRFToken", '{{csrf_token}}');
        },
        success: function(data){
          console.log(data);
        }
      })
    });
  });

</script>

{%endblock%}